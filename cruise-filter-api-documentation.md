# Документация API фильтрации круизов

## Описание

Данная документация описывает параметры GET запросов для фильтрации круизов, которые обрабатываются с помощью `CruiseFilterBeanHelper.form`.

## Базовый URL

Параметры могут быть добавлены к любому эндпоинту, который поддерживает фильтрацию круизов в формате query string.

Пример:
```
/api/cruises?cruiseType[]=50&location.countries[]=123&control.page=1
```

---

## Группы параметров

### 1. Основные параметры круиза

#### `cruiseType[]`
- **Тип:** `Long[]` (массив)
- **Описание:** Тип круиза (морской или речной)
- **Допустимые значения:** 
  - `50` - морской круиз
  - `51` - речной круиз
- **Пример:** `cruiseType[]=50&cruiseType[]=51`

#### `category[]`
- **Тип:** `Long[]` (массив)
- **Описание:** Категории круизов
- **Пример:** `category[]=100&category[]=101`

#### `rivers[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID рек (для речных круизов)
- **Пример:** `rivers[]=5&rivers[]=7`

#### `categoryRivers[]`
- **Тип:** `Long[]` (массив)
- **Описание:** Категории рек
- **Пример:** `categoryRivers[]=10`

#### `cruiseDateRangeId[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID конкретных дат отправления круизов
- **Пример:** `cruiseDateRangeId[]=12345&cruiseDateRangeId[]=12346`

#### `cruiseId[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID конкретных круизов
- **Пример:** `cruiseId[]=999`

---

### 2. Параметры компании и судна (`company.*`)

#### `company.companies[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID круизных компаний
- **Пример:** `company.companies[]=1&company.companies[]=2`

#### `company.companyCategories[]`
- **Тип:** `Long[]` (массив)
- **Описание:** Категории компаний
- **Пример:** `company.companyCategories[]=5`

#### `company.vessels[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID конкретных судов
- **Пример:** `company.vessels[]=101&company.vessels[]=102`

#### `company.vesselCategories[]`
- **Тип:** `Long[]` (массив)
- **Описание:** Категории судов (классы лайнеров)
- **Пример:** `company.vesselCategories[]=3`

---

### 3. Параметры локации (`location.*`)

#### `location.ports[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID портов отправления
- **Пример:** `location.ports[]=200&location.ports[]=201`

#### `location.lastPorts[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID портов прибытия
- **Пример:** `location.lastPorts[]=205`

#### `location.cities[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID городов, которые посещает круиз
- **Пример:** `location.cities[]=300&location.cities[]=301`

#### `location.countries[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID стран отправления
- **Пример:** `location.countries[]=40`

#### `location.countriesTo[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID стран, которые посещает круиз
- **Пример:** `location.countriesTo[]=41&location.countriesTo[]=42`

#### `location.regions[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID регионов
- **Пример:** `location.regions[]=10`

#### `location.continents[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID континентов
- **Пример:** `location.continents[]=1`

---

### 4. Специальные параметры (`special.*`)

#### `special.sales[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID специальных предложений и скидок
- **Пример:** `special.sales[]=15`

#### `special.languageServices[]`
- **Тип:** `Long[]` (массив)
- **Описание:** ID языковых сервисов на борту
- **Пример:** `special.languageServices[]=1&special.languageServices[]=2`

---

### 5. Параметры времени и даты (`time.*`)

#### `time.durations`
- **Тип:** `Integer`
- **Описание:** Продолжительность круиза (позиция из предопределенного списка)
- **Допустимые значения:**
  - `0` - 1-2 дня
  - `1` - 3-5 дней
  - `2` - 6-9 дней
  - `3` - 10-14 дней
  - `4` - 15-35 дней
  - `5` - 36-99 дней
  - `6` - 100+ дней
- **Пример:** `time.durations=2` (круизы длительностью 6-9 дней)

#### `time.fromDate`
- **Тип:** `String` (дата)
- **Описание:** Дата начала поиска (от какой даты искать круизы)
- **Форматы:**
  - `yyyy-MM-dd` (ISO format, например, `2025-03-15`)
- **Пример:** `time.fromDate=2025-03-15`

#### `time.fromDateRange`
- **Тип:** `String` (диапазон дат, используется пробел)
- **Описание:** Диапазон дат начала круиза
- **Формат:** `yyyy-MM-dd - yyyy-MM-dd`
- **Пример:** `time.fromDateRange=2025-03-01 - 2025-03-31`

#### `time.fromDateEnd`
- **Тип:** `String` (дата)
- **Описание:** Конечная дата диапазона для поиска круизов (используется в комбинации с `time.fromDate`)
- **Форматы:** см. `time.fromDate`
- **Пример:** `time.fromDate=2025-01-01&time.fromDateEnd=2025-01-31`

#### `time.toDate`
- **Тип:** `String` (дата)
- **Описание:** Дата окончания круиза
- **Форматы:** см. `time.fromDate`
- **Пример:** `time.toDate=2025-01-31`

#### `time.buildLiner`
- **Тип:** `String` (дата)
- **Описание:** Дата постройки лайнера (для фильтрации по возрасту судна)
- **Форматы:** см. `time.fromDate`
- **Пример:** `time.buildLiner=2020-01-31`

#### `time.useDateWithOutYear`
- **Тип:** `Boolean`
- **Описание:** Использовать дату без учета года (для поиска по месяцам и дням)
- **Значения по умолчанию:** `false`
- **Пример:** `time.useDateWithOutYear=true`

---

### 6. Параметры цены (`price.*`)

#### `price.currency`
- **Тип:** `Long`
- **Описание:** ID валюты для отображения цен
- **Пример:** `price.currency=1` (где 1 может быть ID для USD, EUR и т.д.)
- **Допустимые значения:**
  - `1` - USD
  - `2` - EUR
  - `4` - AMD
  - `5` - PLN
  - `200` - UAH

#### `price.price`
- **Тип:** `BigDecimal`
- **Описание:** Минимальная цена
- **Пример:** `price.price=500.00`

#### `price.maxPrice`
- **Тип:** `BigDecimal`
- **Описание:** Максимальная цена
- **Пример:** `price.maxPrice=5000.00`

---

### 7. Булевы параметры (`bool.*`)

#### `bool.isRusServiceOnly`
- **Тип:** `Boolean`
- **Описание:** Показывать только круизы с русскоязычным сервисом
- **Пример:** `bool.isRusServiceOnly=true`

#### `bool.isSaleOnly`
- **Тип:** `Boolean`
- **Описание:** Показывать только круизы со скидками
- **Пример:** `bool.isSaleOnly=true`

#### `bool.isSortDataByCountCruises`
- **Тип:** `Boolean`
- **Описание:** Сортировать данные по количеству круизов
- **Значение по умолчанию:** `false`
- **Пример:** `bool.isSortDataByCountCruises=true`

#### `bool.isCruiseLoop`
- **Тип:** `Boolean`
- **Описание:** Кольцевой круиз (начало и конец в одном порту)
- **Пример:** `bool.isCruiseLoop=true`

---

### 8. Параметры управления выдачей (`control.*`)

#### `control.page`
- **Тип:** `Integer`
- **Описание:** Номер страницы для пагинации
- **Диапазон:** от 1 до `Int.MaxValue`
- **Значение по умолчанию:** `1`
- **Пример:** `control.page=2`

#### `control.countOnPage`
- **Тип:** `Integer`
- **Описание:** Количество результатов на странице
- **Диапазон:** от 1 до 100
- **Значение по умолчанию:** `10`
- **Пример:** `control.countOnPage=25`

#### `control.order`
- **Тип:** `String`
- **Описание:** Порядок сортировки результатов
- **Допустимые значения:**
  - `BEGIN_DATE_ASC` - по дате начала (возрастание) *по умолчанию*
  - `BEGIN_DATE_DESC` - по дате начала (убывание)
  - `PRICE_VALUE_ASC` - по цене (возрастание)
  - `PRICE_VALUE_DESC` - по цене (убывание)
  - `ADD_ORDER_ASC` - по порядку добавления (возрастание)
  - `ADD_ORDER_DESC` - по порядку добавления (убывание)
- **Пример:** `control.order=PRICE_VALUE_ASC`

---

## Примеры полных запросов

### Пример 1: Поиск морских круизов в Средиземном море
```
/api/cruises?cruiseType[]=50&location.regions[]=5&control.page=1&control.countOnPage=20&control.order=PRICE_VALUE_ASC
```

### Пример 2: Поиск речных круизов с русскоязычным сервисом
```
/api/cruises?cruiseType[]=51&bool.isRusServiceOnly=true&time.durations=2&control.page=1
```

### Пример 3: Поиск круизов со скидками в определенный период
```
/api/cruises?bool.isSaleOnly=true&time.fromDate=01-06-2025&time.fromDateEnd=31-08-2025&control.order=BEGIN_DATE_ASC
```

### Пример 4: Поиск круизов определенной компании с фильтром по цене
```
/api/cruises?company.companies[]=15&price.price=1000&price.maxPrice=3000&price.currency=1&control.countOnPage=50
```

### Пример 5: Комплексный поиск
```
/api/cruises?cruiseType[]=50&location.countries[]=40&location.countriesTo[]=41&location.countriesTo[]=42&time.fromDate=01-04-2025&time.toDate=31-10-2025&price.price=500&price.maxPrice=2000&bool.isSaleOnly=true&control.page=1&control.countOnPage=30&control.order=PRICE_VALUE_ASC
```

---

## Примечания

### Массивы параметров
Параметры с суффиксом `[]` являются массивами и могут быть указаны несколько раз:
```
category[]=100&category[]=101&category[]=102
```

### URL кодирование
Все специальные символы в параметрах должны быть корректно закодированы:
- Пробелы: `%20` или `+`
- Квадратные скобки: `[` = `%5B`, `]` = `%5D`

### Значения по умолчанию
Если параметр не указан, используется значение по умолчанию:
- `control.page`: 1
- `control.countOnPage`: 10
- `control.order`: `BEGIN_DATE_ASC`
- `bool.isSortDataByCountCruises`: false
- `time.useDateWithOutYear`: false

### Комбинирование параметров
Все параметры могут быть скомбинированы в одном запросе. Система применит все указанные фильтры одновременно (логическое AND).

---

## Обработка ошибок

### Неверный формат параметров
Если параметр имеет неверный формат, система:
- Логирует ошибку на сервере
- Возвращает пустую последовательность для этого параметра
- Продолжает обработку остальных параметров

### Пример логов ошибок
```
Error parsing durations, Exception: NumberFormatException
```

### Ошибки валидации
При биндинге формы могут возникнуть следующие ошибки:
- `error.Duration` - неверный формат продолжительности
- `error.CruiseDateRangeOrder` - неверный порядок сортировки
- `error.CruiseFilterBeanTimeRange` - неверный формат диапазона дат
- `Wrong format dd-MM-yyyy` - неверный формат даты

---

## Дополнительная информация

### Форматы дат
1. `yyyy-MM-dd` (ISO формат, рекомендуется)


### Производительность
- Использование большого количества фильтров может увеличить время ответа
- Рекомендуется использовать пагинацию для больших результатов
- Параметр `control.countOnPage` ограничен значением 100 для оптимизации производительности

---

## История изменений

| Дата | Версия | Изменения |
|------|--------|-----------|
| 2025-10-30 | 1.0 | Начальная версия документации |

---

## Контакты и поддержка

Для вопросов и предложений по API обращайтесь к команде разработки ttr-core.

